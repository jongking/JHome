//按下Ctrl-Q有内部函数提示 Console.Write 是输出结果到控制台的方法 CrawlerHelper是爬虫的帮助类 RegexHelper是正则帮助类 ParserHelper是剖析器帮助类
var mainhtml = CrawlerHelper.CrawlOverToStr("http://manhua.dmzj.com/update_2.shtml");

var comicTitleXPath = '//div[@class="boxdiv1"]';
var comicTitle_TitleXPath = '//a[@class="pictextst"]';
var comicTitle_AuthXPath = '//span[@class="gray12"]';
var comicTitle_TypeXPath = '//div[@class="pictext"]/ul[1]/li[3]';
var comicTitle_ImgUrlXPath = '//img[1]';

var xPathDoc = ParserHelper.GetXPathParserDoc(mainhtml);
var rootNode = xPathDoc.DocumentNode;
var comicTitleNodeList = rootNode.SelectNodes(comicTitleXPath);

if(comicTitleNodeList == null){
    Console.Write("comicTitleNodeList == null");
}

Helper.ForEach(comicTitleNodeList, function(obj){
    if(obj == null){
        Console.Write("comicTitleNodeList.obj == null");
        return false;
    }
    else{
        var temp = ParserHelper.GetXPathParserNode(obj.InnerHtml);
        var title = temp.SelectSingleNode(comicTitle_TitleXPath).InnerHtml;
        var auth = temp.SelectSingleNode(comicTitle_AuthXPath).InnerHtml;
        var type = temp.SelectSingleNode(comicTitle_TypeXPath).InnerHtml.replace("分类：", "");
        var ingUrl = temp.SelectSingleNode(comicTitle_ImgUrlXPath).GetAttributeValue("src", "");
        var detailUrl = "http://manhua.dmzj.com/" + temp.SelectSingleNode(comicTitle_TitleXPath).GetAttributeValue("href", "");
        
        var flat = ComicApp.AddComic(title, title, type, auth, title, ingUrl, detailUrl, "dmzj");
        if(flat == true){
//             ComicApp.DownLoadOverImage(title, "http://manhua.dmzj.com/update_1.shtml");
            Console.Write("漫画: " + title + " 添加成功" + auth);
        }
        else{
            Console.Write("漫画: " + title + " 添加失败", 1);
        }
    }
});
